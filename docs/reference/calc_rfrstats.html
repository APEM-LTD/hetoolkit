<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Uses modelled flow data to calculate percentile statistics under a chosen
scenario (e.g. historical or recent actual) as a ratio of a reference scenario (usually
naturalised flows), for one or more sites."><title>Calculating summary statistics describing historical flow conditions — calc_rfrstats • hetoolkit</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculating summary statistics describing historical flow conditions — calc_rfrstats"><meta property="og:description" content="Uses modelled flow data to calculate percentile statistics under a chosen
scenario (e.g. historical or recent actual) as a ratio of a reference scenario (usually
naturalised flows), for one or more sites."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">hetoolkit</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/CaseStudy1.html">HE Toolkit Case Study: macroinvertebrates in chalk streams</a>
    <a class="dropdown-item" href="../articles/CaseStudy2.html">HE Toolkit Case Study: macroinvertebrates in upland rivers</a>
    <a class="dropdown-item" href="../articles/CaseStudy3.html">HE Toolkit Case Study: macrophytes in chalk streams</a>
    <a class="dropdown-item" href="../articles/hetoolkit-vignette.html">hetoolkit-Vignette</a>
    <a class="dropdown-item" href="../articles/Resources.html">Resources</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Calculating summary statistics describing historical flow conditions</h1>
      
      <div class="d-none name"><code>calc_rfrstats.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Uses modelled flow data to calculate percentile statistics under a chosen
scenario (e.g. historical or recent actual) as a ratio of a reference scenario (usually
naturalised flows), for one or more sites.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calc_rfrstats</span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>              site_col <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>              date_col <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>              flow_col <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>              ref_col <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>              q <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>              save_as <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>              save_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span></span>
<span>              <span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>Name of dataframe or tibble containing the flow data to be processed.
Must be in long format (i.e. separate columns for site_id, date, and each flow scenario).</p></dd>


<dt>site_col</dt>
<dd><p>Name of column in data containing unique flow site id.</p></dd>


<dt>date_col</dt>
<dd><p>Name of column in data containing date of flow record in the format of yyyy/mm/dd. See examples for a simple example to reformating the date if needed.</p></dd>


<dt>flow_col</dt>
<dd><p>Name of column in data containing flow values for the scenario of interest
(e.g. historical, recent actual).</p></dd>


<dt>ref_col</dt>
<dd><p>Name of column in data containing flows under the reference (e.g.
naturalised) scenario.</p></dd>


<dt>q</dt>
<dd><p>Required percentile statistic (between 1 and 99).</p></dd>


<dt>save</dt>
<dd><p>Specifies if results should be saved as rds file (for future use); Default = FALSE.</p></dd>


<dt>save_dir</dt>
<dd><p>Path to folder where results are to be saved; Default = Current working directory.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A tibble containing the processed flow statistics for every combination of site
and water year.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>For each water year (e.g. 1 October one year to 30 September the next) at each site, the
chosen flow percentile (q) is calculated under the scenario of interest (qx)
and the reference scenario (qx_ref), where qx takes its name depending on q
(e.g. Q95). The residual flow ratio (RFR) is then calculated as: rfrx = qx / qx_ref.</p>
<p>A q value of 95 represents the flow that is exceeded 95% of the time (i.e. 5th percentile).</p>
<p>In addition, the number of data points in each water year is calculated for
both the scenario of interest (n) and the reference scenario (n_ref).</p>
<p>Modelled flows can be on any time step (e.g. 1, 10, 30 days, or monthly) but should
be at approximately regular time intervals and the same for the both scenarios. The
function does not require a minimum number of records in each water year, but more
extreme percentiles calculated using sparse data may not be meaningful. Any missing
records (NAs) are ignored when calculating summary statistics. The user should check
n and n_ref to identify any water years with incomplete data coverage.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 1</span></span></span>
<span class="r-in"><span><span class="co"># load site model flow data</span></span></span>
<span class="r-in"><span><span class="va">site.model.flow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">site.model.flow</span>, package<span class="op">=</span><span class="st">"hetoolkit"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># calc_rfrstats(data = site.model.flow,</span></span></span>
<span class="r-in"><span><span class="co">#              site_col = "SITE_ID",</span></span></span>
<span class="r-in"><span><span class="co">#              date_col = "Date_end",</span></span></span>
<span class="r-in"><span><span class="co">#              flow_col = "Flow_HIST",</span></span></span>
<span class="r-in"><span><span class="co">#              ref_col = "Flow_NAT",</span></span></span>
<span class="r-in"><span><span class="co">#              q = 75,</span></span></span>
<span class="r-in"><span><span class="co">#              save = FALSE,</span></span></span>
<span class="r-in"><span><span class="co">#              save_dir = getwd())</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by APEM-Ltd.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

