<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="The join_he function links biology data to six-monthly flow statistics (from calc_flowstats) to create a dataset for hydro-ecological modelling. Includes option to lag selected flow statistics."><title>Link biology data to six-monthly flow statistics for paired biology and flow sites. — join_he_old • hetoolkit</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Link biology data to six-monthly flow statistics for paired biology and flow sites. — join_he_old"><meta property="og:description" content="The join_he function links biology data to six-monthly flow statistics (from calc_flowstats) to create a dataset for hydro-ecological modelling. Includes option to lag selected flow statistics."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">hetoolkit</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/CaseStudy1.html">HE Toolkit Case Study: macroinvertebrates in chalk streams</a>
    <a class="dropdown-item" href="../articles/CaseStudy2.html">HE Toolkit Case Study: macroinvertebrates in upland rivers</a>
    <a class="dropdown-item" href="../articles/hetoolkit-vignette.html">hetoolkit-Vignette</a>
    <a class="dropdown-item" href="../articles/Resources.html">Resources</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Link biology data to six-monthly flow statistics for paired biology and flow sites.</h1>
      
      <div class="d-none name"><code>join_he_old.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The join_he function links biology data to six-monthly flow statistics (from <code>calc_flowstats</code>) to create a dataset for hydro-ecological modelling. Includes option to lag selected flow statistics.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">join_he_old</span><span class="op">(</span>biol_data <span class="op">=</span> <span class="va">biol_data</span>, flow_stats <span class="op">=</span> <span class="va">flow_stats</span>, mapping <span class="op">=</span> <span class="cn">NULL</span>, LS1 <span class="op">=</span> <span class="cn">FALSE</span>, LS2 <span class="op">=</span> <span class="cn">FALSE</span>, lag_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Q10z"</span>, <span class="st">"Q95z"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>biol_data</dt>
<dd><p>Data frame or tibble containing the processed biology data. Must contain the following columns: biol_site_id, Year and Season. Seasons must be named "Spring" and "Autumn". See Details below.</p></dd>


<dt>flow_stats</dt>
<dd><p>Data frame (first element of list returned by the <code>calc_flowstats</code> function), containing the processed flow statistics. Must contain the following columns: flow_site_id, water_year and season.</p></dd>


<dt>mapping</dt>
<dd><p>Data frame or tibble containing paired biology and flow site IDs. Must contain columns named biol_site_id and flow_site_id. These columns must not contain any NAs. Default = NULL, used when paired biology and flow sites are assumed to have identical ids, and so mapping not required.</p></dd>


<dt>LS1</dt>
<dd><p>Logical value indicating whether or not to also link biology samples to flow statistics for the summer period of the previous year. Default = FALSE.</p></dd>


<dt>LS2</dt>
<dd><p>Logical value indicating whether or not to also link biology samples to flow statistics for the summer period of the year before last. Default = FALSE.</p></dd>


<dt>lag_vars</dt>
<dd><p>List of flow variables from 'flow_stats' to be lagged if LS1 and/or LS2 = TRUE. Default = two commonly-used flow statistics: Q10z and Q95z.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>join_he returns a tibble containing processed biology data linked to processed flow statistics.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>join_he is not intended to join biology data to residual flow ratio statistics (from <code>calc_rfrstats</code>) because these are on an annual time step, rather than six-monthly, and therefore easy to join manually.</p>
<p>'biol_data' and 'flow_stats' may contain more sites than listed in 'mapping', but any sites not listed in 'mapping' will be filtered out.</p>
<p>'biol_data' must contain the following columns: biol_site_id, Year and Season. Seasons must be named "Spring" and "Autumn".</p>
<p>join_he joins spring (March to May) biology samples to flow statistics for the preceding winter (October to March) period, and autumn (September to November) samples to  flow statistics for the preceding summer (April to September) period. Any winter (December to February) or summer (June to August) biology samples are dropped. All flow statistics in 'flow_stats' are joined; any superfluous variables must be dropped manually, either before or after executing the join_he function.</p>
<p>If LS1 = TRUE, spring biology samples are also joined to flow statistics for the summer period of the previous year. These flow statistics are renamed with the suffix 'LS1'. Only the flow statistics listed in 'lag_vars' are joined in this way.</p>
<p>If LS2 = TRUE, spring biology samples are also joined to flow statistics for the summer period of the year before last. These flow statistics are renamed with the suffix 'LS2'. Only the flow statistics listed in 'lag_vars' are joined in this way.</p>
<p>To facilitate subsequent data visualisation and modelling, the function uses expand.grid to generate all combinations of biol_site_id, season (spring, autumn) and year (ranging from the earliest to the latest year in biol_data). Left joins are used to link the biology data and flow statistics to this expanded grid.</p>
<p>It is recommended that any replicate or duplicate biology samples collected from a site in the same season and year are averaged out or eliminated before executing this function.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Join processed biology data and processed flow statistics - no mapping specified because paired flow and biology sites have identical ids. Do not lag flow statistics.</span></span></span>
<span class="r-in"><span><span class="co"># join_he(biol_data = biol_all,</span></span></span>
<span class="r-in"><span><span class="co">#          flow_stats = flowstats_1,</span></span></span>
<span class="r-in"><span><span class="co">#          mapping = NULL,</span></span></span>
<span class="r-in"><span><span class="co">#          LS1 = FALSE,</span></span></span>
<span class="r-in"><span><span class="co">#          LS2 = FALSE)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Join processed biology data and processed flow statistics using mapping specified. Link biology data to summer flows in previous year - flow variables to lag specified.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># join_he(biol_data = biol_all,</span></span></span>
<span class="r-in"><span><span class="co">#          flow_stats = flowstats_1,</span></span></span>
<span class="r-in"><span><span class="co">#          mapping = SiteList,</span></span></span>
<span class="r-in"><span><span class="co">#          LS1 = TRUE,</span></span></span>
<span class="r-in"><span><span class="co">#          LS2 = FALSE,</span></span></span>
<span class="r-in"><span><span class="co">#          lag_vars = c("Q10z", "Q95z", "Q70z"))</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Join processed biology and processed flow statistics</span></span></span>
<span class="r-in"><span><span class="co">### Includes an example of user-create mapping data frame.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># flow_data &lt;- import_hde(sites = c("AA", "BB"))</span></span></span>
<span class="r-in"><span><span class="co"># flow_stats &lt;- calc_flowstats(flow_data)</span></span></span>
<span class="r-in"><span><span class="co"># biol_data &lt;- import_biology(sites = c("XX", "YY"))</span></span></span>
<span class="r-in"><span><span class="co"># mapping &lt;- data.frame(biol_site_id = c("XX", "YY"), flow_site_id = c("BB", "AA"))</span></span></span>
<span class="r-in"><span><span class="co"># join_he(biol_data = biol_data,</span></span></span>
<span class="r-in"><span><span class="co">#        flow_stats = flow_stats,</span></span></span>
<span class="r-in"><span><span class="co">#        mapping = mapping)</span></span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by APEM-Ltd.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

