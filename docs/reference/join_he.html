<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function joins biology sample data with time-varying flow statistics for one or more antecedent (lagged) time periods (as calculated by the calc_flowstats function) to create a combined dataset for hydro-ecological modelling."><title>Linking biology samples with time-varying flow statistics for paired biology and flow sites. — join_he • hetoolkit</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Linking biology samples with time-varying flow statistics for paired biology and flow sites. — join_he"><meta property="og:description" content="This function joins biology sample data with time-varying flow statistics for one or more antecedent (lagged) time periods (as calculated by the calc_flowstats function) to create a combined dataset for hydro-ecological modelling."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">hetoolkit</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/case_study_1.html">Case Study 1</a>
    <a class="dropdown-item" href="../articles/case_study_2.html">Case Study 2</a>
    <a class="dropdown-item" href="../articles/case_study_3.html">Case Study 3</a>
    <a class="dropdown-item" href="../articles/case_study_4.html">Case Study 4</a>
    <a class="dropdown-item" href="../articles/hetoolkit-vignette.html">hetoolkit-Vignette</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Linking biology samples with time-varying flow statistics for paired biology and flow sites.</h1>
      
      <div class="d-none name"><code>join_he.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function joins biology sample data with time-varying flow statistics for one or more antecedent (lagged) time periods (as calculated by the <code>calc_flowstats</code> function) to create a combined dataset for hydro-ecological modelling.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">join_he</span><span class="op">(</span><span class="va">biol_data</span>, <span class="va">flow_stats</span>, mapping <span class="op">=</span> <span class="cn">NULL</span>, method <span class="op">=</span> <span class="st">"A"</span> , lags <span class="op">=</span> <span class="fl">0</span>, join_type <span class="op">=</span> <span class="st">"add_flows"</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>biol_data</dt>
<dd><p>Data frame or tibble containing the processed biology data. Must contain the following columns: biol_site_id and date (in date format).</p></dd>


<dt>flow_stats</dt>
<dd><p>Data frame or tibble containing the calculated time-varying flow statistics, by site and time period and win_no (as produced by the <code>calc_flowstats</code> function ). Must contain the following columns: <code>flow_site_id</code>, <code>start_date</code> and <code>end_date</code>. The function joins all the variables in <code>flow_stats</code>, so it is advisable to manually drop any flow statistics which are not of interest before applying the function.</p></dd>


<dt>mapping</dt>
<dd><p>Data frame or tibble containing paired biology sites IDs and flow site IDs. Must contain columns named biol_site_id and flow_site_id. These columns must not contain any NAs. Default = <code>NULL</code>, which assumes that paired biology and flow sites have identical ids, so mapping is not required.</p></dd>


<dt>method</dt>
<dd><p>Choice of method for linking biology samples to flow statistics for antecedent time periods. Using method = "A" (default), lag 0 is defined for each biology sample as the most recently finished flow time period; using method = "B", lag 0 is defined as the most recently started flow time period. See below for details.</p></dd>


<dt>lags</dt>
<dd><p>Vector of lagged flow time periods of interest. Values must be zero or positive, with larger values representing longer time lags (i.e. an increasing time gap between the flow time period and the biology sample date). Default = 0. See below for details.</p></dd>


<dt>join_type</dt>
<dd><p>To add flow statistics to each biology sample, choose "add_flows" (default); this produces a dataset of biology metrics (response variables) and flow statistics (predictor variables) for hydro-ecological modelling. To add biology sample data to flow statistics for each time period, choose "add_biol"; this produces a time series of flow statistics with associated biological metrics which can be used, for example, to assess the coverage of historical flow conditions using the <code>plot_rngflows</code> function.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p><code>join_he</code> returns a tibble containing the linked biology data and flow statistics.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>biol_data</code> and <code>flow_stats</code> may contain more sites than listed in <code>mapping</code>, but any sites not listed in <code>mapping</code> will be filtered out. If <code>mapping = NULL</code>, then biology site and flow sites with matching ids will be paired automatically.</p>
<p>The <code>calc_flowstats</code> function uses a moving window approach to calculate a time-varying flow statistics for a  sequence of time periods which can be either: (i) contiguous (i.e. each time period is followed immediately by the next one), (ii) non-contiguous (i.e. there is a gap between one time period at the next), or (iii) over-lapping (i.e. the next time period stats before the previous one has finished).</p>
<p>To describe the antecedent flow conditions prior to each biology sample, the time periods are labelled relative to the date of the biology sample, with lag 0 representing either the most recently finished (<code>method = "A"</code>) or most recently started (<code>method = "B"</code>) flow time period. The time period immediately prior to the Lag 0 time period is the Lag 1 period, and the period immediately prior to that is the Lag 2 period, and so on.</p>
<p>As an example, suppose we have a biology sample dated 15 September 2020 and that flow statistics are available for a sequence of contiguous 1 month periods (each one a calendar month). Using <code>method = "A"</code>, the Lag 0 period for that biology sample would be August 2020 (the most recently finished time period), the Lag 1 period would be July 2020, the Lag 2 period would be June 2020, and so on. Similarly, using <code>method = "B"</code>, the Lag 0 period for that biology sample would be September 2020 (the most recently started time period), the Lag 1 period would be August 2020, the Lag 2 period would be July 2020, and so on.</p>
<p>As a second example, suppose we again have a biology sample dated 15 September 2020 and that flow statistics are available for a sequence of overlapping 6 month periods (i.e. February to July 2020, March to August 2020, April to September 2020, and so on). Using <code>method = "A"</code>, the Lag 0 period for that biology sample would be March to August 2020 (the most recently finished time period), the Lag 1 period would be February to July 2020, the Lag 2 period would be January to June 2020, and so on. Similarly, using <code>method ="B"</code>, the Lag 0 period for that biology sample would be September 2000 to February 2021 (the most recently started time period), the Lag 1 period would be 1 August 2000 to January 2021, the Lag 2 period would be July to December 2020, and so on.</p>
<p>Note that if using <code>join_type = "add_biol"</code>, a flow period becomes replicated if it has 2+ biology samples within it. To avoid this happening, summarise (e.g. average) the replicate biology samples within each time window before applying <code>join_he</code>. See below for an example.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create flow stats from synthetic flow data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">flow_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>flow_site_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"A0001"</span>, <span class="fl">365</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-12-31"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"1 day"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        flow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">365</span>, <span class="fl">10</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">flow_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="calc_flowstats.html">calc_flowstats</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">flow_data</span>,</span></span>
<span class="r-in"><span>                             site_col <span class="op">=</span> <span class="st">"flow_site_id"</span>,</span></span>
<span class="r-in"><span>                             date_col <span class="op">=</span> <span class="st">"date"</span>,</span></span>
<span class="r-in"><span>                             flow_col <span class="op">=</span> <span class="st">"flow"</span>,</span></span>
<span class="r-in"><span>                             win_start <span class="op">=</span>  <span class="st">"2021-01-01"</span>,</span></span>
<span class="r-in"><span>                             win_width <span class="op">=</span> <span class="st">"1 month"</span>,</span></span>
<span class="r-in"><span>                             win_step <span class="op">=</span>  <span class="st">"1 month"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">flow_site_id</span>, <span class="va">win_no</span>, <span class="va">start_date</span>, <span class="va">end_date</span>, <span class="va">Q95z</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Joining with `by = join_by(site, win_no, n_data)`</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create synthetic biology data</span></span></span>
<span class="r-in"><span><span class="va">biol_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>biol_site_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"A0001"</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2021-04-15"</span>, <span class="st">"2021-09-15"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.7</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># view data</span></span></span>
<span class="r-in"><span><span class="va">flow_stats</span>; <span class="va">biol_data</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    flow_site_id win_no start_date   end_date        Q95z</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         A0001      1 2021-01-01 2021-01-31 -0.31871603</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         A0001      2 2021-02-01 2021-02-28  0.70614692</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         A0001      3 2021-03-01 2021-03-31  0.97917882</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4         A0001      4 2021-04-01 2021-04-30  0.17013587</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5         A0001      5 2021-05-01 2021-05-31 -0.75563412</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6         A0001      6 2021-06-01 2021-06-30  1.23495888</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7         A0001      7 2021-07-01 2021-07-31  0.69520028</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8         A0001      8 2021-08-01 2021-08-31  0.52935726</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9         A0001      9 2021-09-01 2021-09-30 -0.23660759</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10        A0001     10 2021-10-01 2021-10-31  0.08601627</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11        A0001     11 2021-11-01 2021-11-30 -0.61904164</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12        A0001     12 2021-12-01 2021-12-31 -2.47099491</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13        A0001     13 2022-01-01 2022-01-31          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14        A0001     14 2022-02-01 2022-02-28          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15        A0001     15 2022-03-01 2022-03-31          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16        A0001     16 2022-04-01 2022-04-30          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17        A0001     17 2022-05-01 2022-05-31          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18        A0001     18 2022-06-01 2022-06-30          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19        A0001     19 2022-07-01 2022-07-31          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20        A0001     20 2022-08-01 2022-08-31          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21        A0001     21 2022-09-01 2022-09-30          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22        A0001     22 2022-10-01 2022-10-31          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23        A0001     23 2022-11-01 2022-11-30          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24        A0001     24 2022-12-01 2022-12-31          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25        A0001     25 2023-01-01 2023-01-31          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26        A0001     26 2023-02-01 2023-02-28          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27        A0001     27 2023-03-01 2023-03-31          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28        A0001     28 2023-04-01 2023-04-30          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   biol_site_id       date metric</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        A0001 2021-04-15    0.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        A0001 2021-09-15    0.7</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># add flow statistics to each biology sample using method A</span></span></span>
<span class="r-in"><span><span class="co"># mapping = NULL because biology and flow sites have identical ids</span></span></span>
<span class="r-in"><span><span class="fu">join_he</span><span class="op">(</span>biol_data <span class="op">=</span> <span class="va">biol_data</span>,</span></span>
<span class="r-in"><span>        flow_stats <span class="op">=</span> <span class="va">flow_stats</span>,</span></span>
<span class="r-in"><span>        mapping <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>        method <span class="op">=</span> <span class="st">"A"</span>,</span></span>
<span class="r-in"><span>        lags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        join_type <span class="op">=</span> <span class="st">"add_flows"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   biol_site_id       date metric flow_site_id win_no start_date   end_date</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        A0001 2021-04-15    0.8        A0001      3 2021-03-01 2021-03-31</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        A0001 2021-09-15    0.7        A0001      8 2021-08-01 2021-08-31</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   win_no_lag0 Q95z_lag0 win_no_lag1 Q95z_lag1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1           3 0.9791788           2 0.7061469</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           8 0.5293573           7 0.6952003</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># add flow statistics to each biology sample using method B</span></span></span>
<span class="r-in"><span><span class="co"># mapping = NULL because biology and flow sites have identical ids</span></span></span>
<span class="r-in"><span><span class="fu">join_he</span><span class="op">(</span>biol_data <span class="op">=</span> <span class="va">biol_data</span>,</span></span>
<span class="r-in"><span>        flow_stats <span class="op">=</span> <span class="va">flow_stats</span>,</span></span>
<span class="r-in"><span>        mapping <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>        method <span class="op">=</span> <span class="st">"B"</span>,</span></span>
<span class="r-in"><span>        lags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        join_type <span class="op">=</span> <span class="st">"add_flows"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   biol_site_id       date metric flow_site_id win_no start_date   end_date</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        A0001 2021-04-15    0.8        A0001      4 2021-04-01 2021-04-30</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        A0001 2021-09-15    0.7        A0001      9 2021-09-01 2021-09-30</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   win_no_lag0  Q95z_lag0 win_no_lag1 Q95z_lag1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1           4  0.1701359           3 0.9791788</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           9 -0.2366076           8 0.5293573</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># add biology sample data to flow statistics for each time period using method A</span></span></span>
<span class="r-in"><span><span class="fu">join_he</span><span class="op">(</span>biol_data <span class="op">=</span> <span class="va">biol_data</span>,</span></span>
<span class="r-in"><span>        flow_stats <span class="op">=</span> <span class="va">flow_stats</span>,</span></span>
<span class="r-in"><span>        mapping <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>        method <span class="op">=</span> <span class="st">"A"</span>,</span></span>
<span class="r-in"><span>        lags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        join_type <span class="op">=</span> <span class="st">"add_biol"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    flow_site_id win_no start_date   end_date win_no_lag0   Q95z_lag0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         A0001      1 2021-01-01 2021-01-31           1 -0.31871603</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         A0001      2 2021-02-01 2021-02-28           2  0.70614692</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         A0001      3 2021-03-01 2021-03-31           3  0.97917882</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4         A0001      4 2021-04-01 2021-04-30           4  0.17013587</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5         A0001      5 2021-05-01 2021-05-31           5 -0.75563412</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6         A0001      6 2021-06-01 2021-06-30           6  1.23495888</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7         A0001      7 2021-07-01 2021-07-31           7  0.69520028</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8         A0001      8 2021-08-01 2021-08-31           8  0.52935726</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9         A0001      9 2021-09-01 2021-09-30           9 -0.23660759</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10        A0001     10 2021-10-01 2021-10-31          10  0.08601627</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11        A0001     11 2021-11-01 2021-11-30          11 -0.61904164</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12        A0001     12 2021-12-01 2021-12-31          12 -2.47099491</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13        A0001     13 2022-01-01 2022-01-31          13          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14        A0001     14 2022-02-01 2022-02-28          14          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15        A0001     15 2022-03-01 2022-03-31          15          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16        A0001     16 2022-04-01 2022-04-30          16          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17        A0001     17 2022-05-01 2022-05-31          17          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18        A0001     18 2022-06-01 2022-06-30          18          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19        A0001     19 2022-07-01 2022-07-31          19          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20        A0001     20 2022-08-01 2022-08-31          20          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21        A0001     21 2022-09-01 2022-09-30          21          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22        A0001     22 2022-10-01 2022-10-31          22          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23        A0001     23 2022-11-01 2022-11-30          23          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24        A0001     24 2022-12-01 2022-12-31          24          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25        A0001     25 2023-01-01 2023-01-31          25          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26        A0001     26 2023-02-01 2023-02-28          26          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27        A0001     27 2023-03-01 2023-03-31          27          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28        A0001     28 2023-04-01 2023-04-30          28          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    win_no_lag1   Q95z_lag1 biol_site_id       date metric</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1            0          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2            1 -0.31871603        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3            2  0.70614692        A0001 2021-04-15    0.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4            3  0.97917882        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5            4  0.17013587        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6            5 -0.75563412        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7            6  1.23495888        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8            7  0.69520028        A0001 2021-09-15    0.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9            8  0.52935726        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10           9 -0.23660759        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11          10  0.08601627        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12          11 -0.61904164        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13          12 -2.47099491        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14          13          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15          14          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16          15          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17          16          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18          17          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19          18          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20          19          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21          20          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22          21          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23          22          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24          23          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25          24          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26          25          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27          26          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28          27          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># add biology sample data to flow statistics for each time period using method B</span></span></span>
<span class="r-in"><span><span class="fu">join_he</span><span class="op">(</span>biol_data <span class="op">=</span> <span class="va">biol_data</span>,</span></span>
<span class="r-in"><span>        flow_stats <span class="op">=</span> <span class="va">flow_stats</span>,</span></span>
<span class="r-in"><span>        mapping <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>        method <span class="op">=</span> <span class="st">"B"</span>,</span></span>
<span class="r-in"><span>        lags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        join_type <span class="op">=</span> <span class="st">"add_biol"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    flow_site_id win_no start_date   end_date win_no_lag0   Q95z_lag0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         A0001      1 2021-01-01 2021-01-31           1 -0.31871603</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         A0001      2 2021-02-01 2021-02-28           2  0.70614692</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         A0001      3 2021-03-01 2021-03-31           3  0.97917882</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4         A0001      4 2021-04-01 2021-04-30           4  0.17013587</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5         A0001      5 2021-05-01 2021-05-31           5 -0.75563412</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6         A0001      6 2021-06-01 2021-06-30           6  1.23495888</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7         A0001      7 2021-07-01 2021-07-31           7  0.69520028</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8         A0001      8 2021-08-01 2021-08-31           8  0.52935726</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9         A0001      9 2021-09-01 2021-09-30           9 -0.23660759</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10        A0001     10 2021-10-01 2021-10-31          10  0.08601627</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11        A0001     11 2021-11-01 2021-11-30          11 -0.61904164</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12        A0001     12 2021-12-01 2021-12-31          12 -2.47099491</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13        A0001     13 2022-01-01 2022-01-31          13          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14        A0001     14 2022-02-01 2022-02-28          14          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15        A0001     15 2022-03-01 2022-03-31          15          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16        A0001     16 2022-04-01 2022-04-30          16          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17        A0001     17 2022-05-01 2022-05-31          17          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18        A0001     18 2022-06-01 2022-06-30          18          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19        A0001     19 2022-07-01 2022-07-31          19          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20        A0001     20 2022-08-01 2022-08-31          20          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21        A0001     21 2022-09-01 2022-09-30          21          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22        A0001     22 2022-10-01 2022-10-31          22          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23        A0001     23 2022-11-01 2022-11-30          23          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24        A0001     24 2022-12-01 2022-12-31          24          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25        A0001     25 2023-01-01 2023-01-31          25          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26        A0001     26 2023-02-01 2023-02-28          26          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27        A0001     27 2023-03-01 2023-03-31          27          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28        A0001     28 2023-04-01 2023-04-30          28          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    win_no_lag1   Q95z_lag1 biol_site_id       date metric</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1            0          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2            1 -0.31871603        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3            2  0.70614692        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4            3  0.97917882        A0001 2021-04-15    0.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5            4  0.17013587        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6            5 -0.75563412        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7            6  1.23495888        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8            7  0.69520028        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9            8  0.52935726        A0001 2021-09-15    0.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10           9 -0.23660759        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11          10  0.08601627        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12          11 -0.61904164        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13          12 -2.47099491        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14          13          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15          14          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16          15          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17          16          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18          17          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19          18          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20          19          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21          20          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22          21          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23          22          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24          23          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25          24          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26          25          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27          26          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28          27          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># using join_type = "add_biol", a flow period becomes replicated if it has 2+ biology samples</span></span></span>
<span class="r-in"><span><span class="va">biol_data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>biol_site_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"A0001"</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                         date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2021-04-15"</span>, <span class="st">"2021-09-15"</span>, <span class="st">"2021-09-17"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                         metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.7</span>, <span class="fl">0.6</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">join_he</span><span class="op">(</span>biol_data <span class="op">=</span> <span class="va">biol_data2</span>,</span></span>
<span class="r-in"><span>        flow_stats <span class="op">=</span> <span class="va">flow_stats</span>,</span></span>
<span class="r-in"><span>        mapping <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>        method <span class="op">=</span> <span class="st">"A"</span>,</span></span>
<span class="r-in"><span>        lags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        join_type <span class="op">=</span> <span class="st">"add_biol"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    flow_site_id win_no start_date   end_date win_no_lag0   Q95z_lag0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         A0001      1 2021-01-01 2021-01-31           1 -0.31871603</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         A0001      2 2021-02-01 2021-02-28           2  0.70614692</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         A0001      3 2021-03-01 2021-03-31           3  0.97917882</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4         A0001      4 2021-04-01 2021-04-30           4  0.17013587</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5         A0001      5 2021-05-01 2021-05-31           5 -0.75563412</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6         A0001      6 2021-06-01 2021-06-30           6  1.23495888</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7         A0001      7 2021-07-01 2021-07-31           7  0.69520028</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8         A0001      8 2021-08-01 2021-08-31           8  0.52935726</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9         A0001      8 2021-08-01 2021-08-31           8  0.52935726</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10        A0001      9 2021-09-01 2021-09-30           9 -0.23660759</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11        A0001     10 2021-10-01 2021-10-31          10  0.08601627</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12        A0001     11 2021-11-01 2021-11-30          11 -0.61904164</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13        A0001     12 2021-12-01 2021-12-31          12 -2.47099491</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14        A0001     13 2022-01-01 2022-01-31          13          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15        A0001     14 2022-02-01 2022-02-28          14          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16        A0001     15 2022-03-01 2022-03-31          15          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17        A0001     16 2022-04-01 2022-04-30          16          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18        A0001     17 2022-05-01 2022-05-31          17          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19        A0001     18 2022-06-01 2022-06-30          18          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20        A0001     19 2022-07-01 2022-07-31          19          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21        A0001     20 2022-08-01 2022-08-31          20          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22        A0001     21 2022-09-01 2022-09-30          21          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23        A0001     22 2022-10-01 2022-10-31          22          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24        A0001     23 2022-11-01 2022-11-30          23          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25        A0001     24 2022-12-01 2022-12-31          24          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26        A0001     25 2023-01-01 2023-01-31          25          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27        A0001     26 2023-02-01 2023-02-28          26          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28        A0001     27 2023-03-01 2023-03-31          27          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29        A0001     28 2023-04-01 2023-04-30          28          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    win_no_lag1   Q95z_lag1 biol_site_id       date metric</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1            0          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2            1 -0.31871603        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3            2  0.70614692        A0001 2021-04-15    0.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4            3  0.97917882        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5            4  0.17013587        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6            5 -0.75563412        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7            6  1.23495888        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8            7  0.69520028        A0001 2021-09-15    0.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9            7  0.69520028        A0001 2021-09-17    0.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10           8  0.52935726        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11           9 -0.23660759        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12          10  0.08601627        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13          11 -0.61904164        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14          12 -2.47099491        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15          13          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16          14          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17          15          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18          16          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19          17          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20          18          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21          19          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22          20          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23          21          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24          22          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25          23          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26          24          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27          25          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28          26          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29          27          NA        A0001       &lt;NA&gt;     NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># average replicate biology samples within each time window before using join_type = "add_biol"</span></span></span>
<span class="r-in"><span><span class="va">biol_data3</span> <span class="op">&lt;-</span> <span class="va">biol_data2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>month <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">biol_site_id</span>, <span class="va">month</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_all</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">join_he</span><span class="op">(</span>biol_data <span class="op">=</span> <span class="va">biol_data3</span>,</span></span>
<span class="r-in"><span>        flow_stats <span class="op">=</span> <span class="va">flow_stats</span>,</span></span>
<span class="r-in"><span>        mapping <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>        method <span class="op">=</span> <span class="st">"A"</span>,</span></span>
<span class="r-in"><span>        lags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        join_type <span class="op">=</span> <span class="st">"add_biol"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    flow_site_id win_no start_date   end_date win_no_lag0   Q95z_lag0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         A0001      1 2021-01-01 2021-01-31           1 -0.31871603</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         A0001      2 2021-02-01 2021-02-28           2  0.70614692</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         A0001      3 2021-03-01 2021-03-31           3  0.97917882</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4         A0001      4 2021-04-01 2021-04-30           4  0.17013587</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5         A0001      5 2021-05-01 2021-05-31           5 -0.75563412</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6         A0001      6 2021-06-01 2021-06-30           6  1.23495888</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7         A0001      7 2021-07-01 2021-07-31           7  0.69520028</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8         A0001      8 2021-08-01 2021-08-31           8  0.52935726</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9         A0001      9 2021-09-01 2021-09-30           9 -0.23660759</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10        A0001     10 2021-10-01 2021-10-31          10  0.08601627</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11        A0001     11 2021-11-01 2021-11-30          11 -0.61904164</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12        A0001     12 2021-12-01 2021-12-31          12 -2.47099491</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13        A0001     13 2022-01-01 2022-01-31          13          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14        A0001     14 2022-02-01 2022-02-28          14          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15        A0001     15 2022-03-01 2022-03-31          15          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16        A0001     16 2022-04-01 2022-04-30          16          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17        A0001     17 2022-05-01 2022-05-31          17          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18        A0001     18 2022-06-01 2022-06-30          18          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19        A0001     19 2022-07-01 2022-07-31          19          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20        A0001     20 2022-08-01 2022-08-31          20          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21        A0001     21 2022-09-01 2022-09-30          21          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22        A0001     22 2022-10-01 2022-10-31          22          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23        A0001     23 2022-11-01 2022-11-30          23          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24        A0001     24 2022-12-01 2022-12-31          24          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25        A0001     25 2023-01-01 2023-01-31          25          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26        A0001     26 2023-02-01 2023-02-28          26          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27        A0001     27 2023-03-01 2023-03-31          27          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28        A0001     28 2023-04-01 2023-04-30          28          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    win_no_lag1   Q95z_lag1 biol_site_id month       date metric</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1            0          NA        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2            1 -0.31871603        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3            2  0.70614692        A0001     4 2021-04-15   0.80</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4            3  0.97917882        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5            4  0.17013587        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6            5 -0.75563412        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7            6  1.23495888        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8            7  0.69520028        A0001     9 2021-09-16   0.65</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9            8  0.52935726        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10           9 -0.23660759        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11          10  0.08601627        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12          11 -0.61904164        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13          12 -2.47099491        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14          13          NA        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15          14          NA        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16          15          NA        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17          16          NA        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18          17          NA        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19          18          NA        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20          19          NA        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21          20          NA        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22          21          NA        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23          22          NA        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24          23          NA        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25          24          NA        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26          25          NA        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27          26          NA        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28          27          NA        A0001    NA       &lt;NA&gt;     NA</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by APEM-Ltd.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

