<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="hetoolkit">
<title>HE Toolkit Case Study: climwin analysis • hetoolkit</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="HE Toolkit Case Study: climwin analysis">
<meta property="og:description" content="hetoolkit">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">hetoolkit</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/CaseStudy1.html">HE Toolkit Case Study: macroinvertebrates in chalk streams</a>
    <a class="dropdown-item" href="../articles/CaseStudy2.html">HE Toolkit Case Study: macroinvertebrates in upland rivers</a>
    <a class="dropdown-item" href="../articles/CaseStudy3.html">HE Toolkit Case Study: macrophytes in chalk streams</a>
    <a class="dropdown-item" href="../articles/CaseStudy4.html">HE Toolkit Case Study: climwin analysis</a>
    <a class="dropdown-item" href="../articles/hetoolkit-vignette.html">HE Toolkit Vignette</a>
    <a class="dropdown-item" href="../articles/Resources.html">Resources</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="CaseStudy4_files/kePrint-0.0.1/kePrint.js"></script><link href="CaseStudy4_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>HE Toolkit Case Study: climwin analysis</h1>
                        <h4 data-toc-skip class="author">Environment
Agency (National Hydroecology Team, WR E&amp;B) &amp; APEM</h4>
            
            <h4 data-toc-skip class="date">2024-03-28</h4>
      
      
      <div class="d-none name"><code>CaseStudy4.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>One of the greatest challenges in building hydroecological models is
how to select the most appropriate time period over which to calculate
flow or flow alteration statistics. The choice of this period, or
‘window’, may be informed by knowledge of the river type(s) under
investigation or target species phenology, but this expert opinion-based
approach is subjective and provides no statistical confidence that the
selected window is the most ecologically relevant. However, analytical
methods are available that can be used to detect the time period over
which environmental conditions are the best predictor of ecological
responses.</p>
<p>This case study illustrates the use of one such method, a
moving-window technique called climwin (short for climate window
analysis), implemented using the R package of the same name (Bailey
&amp; van de Pol, 2016, <em>PLoS ONE</em> 11(12): e0167980). It uses EA
macroinvertebrate data collected from 1995-2015 from chalk streams
covered by the Herts North London (HNL), Northern East Anglian Chalk
(NEAC), Cambridge Bedford Ouse (CBO) and Test &amp; Itchen (T&amp;I)
groundwater models. Invertebrate sampling sites were spatially matched
with groundwater model timeseries locations and screened to exclude
sites with (i) &lt;10 samples or &lt;5 years of record, (ii)
non-perennial flow, (iii) water quality issues, (iv) extensive physical
modification or (v) inadequate groundwater model coverage or
calibration. Groundwater model outputs were used to calculate monthly
historical and naturalised mean flows, which were then combined to give
a residual flow ratio (RFR) for each month. RFR is a simple measure of
flow alteration, with values of &lt;1, 1 and &gt;1 signifying flows
below, at and above natural respectively.</p>
<p>The purpose of this case study is to illustrate the use of the
climwin method in the context of establishing flow-ecology
relationships, rather than to demonstrate the various functions of the
HE Toolkit (which are covered in other case studies). For brevity it
therefore uses macroinvertebrate and flow data that have already been
collated and processed.</p>
</div>
<div class="section level2">
<h2 id="set-up">Set-up<a class="anchor" aria-label="anchor" href="#set-up"></a>
</h2>
<p>Install and load the HE Toolkit and other necessary packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages('remotes')</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span></span>
<span><span class="co"># Conditionally install hetoolkit from github</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="st">"hetoolkit"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"APEM-LTD/hetoolkit"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">hetoolkit</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/trinker/pacman" class="external-link">"pacman"</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"pacman"</span><span class="op">)</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html" class="external-link">p_load</a></span><span class="op">(</span><span class="va">readxl</span>, <span class="va">gridExtra</span>, <span class="va">plyr</span>, <span class="va">dplyr</span>, <span class="va">arrow</span>, <span class="va">mgcv</span>, <span class="va">readxl</span>, <span class="va">forecast</span>, <span class="va">gratia</span>, <span class="va">lme4</span>, <span class="va">climwin</span>,</span>
<span>    <span class="va">knitr</span>, <span class="va">kableExtra</span>, <span class="va">sjPlot</span><span class="op">)</span></span></code></pre></div>
<p>Load the biology and flow datasets:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cs3_biol_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"data/CaseStudy4/cs4_biol_data.RDS"</span><span class="op">)</span></span>
<span><span class="va">cs3_flow_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"data/CaseStudy4/cs4_flow_data.RDS"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="climwin">Climwin<a class="anchor" aria-label="anchor" href="#climwin"></a>
</h2>
<p>We can now use climwin to detect the time window over which a
macroinvertebrate community metric (LIFE family index) is best predicted
by antecedent flow alteration. Note that we do not pair the biology and
flow datasets using the HE Toolkit’s <em>join_he</em> function, but
instead feed them as separate inputs into climwin’s <em>slidingwin</em>
function. This works as the biology and flow sites have already been
spatially matched, with both datasets sharing the same set of site
IDs.</p>
<p>For this case study three mixed-effects models of varying complexity
are used to capture LIFE responses to flow alteration (linear, quadratic
and cubic), and their performance is then compared. This ensures that
the process of detecting the most ecologically relevant antecedent flow
period is not biased by prior assumptions about the shape of the
flow-ecology relationship (e.g. linear or non-linear). To capture the
influences of sampling year and random site-to-site variability on mean
LIFE scores all models here take the form:</p>
<p>LIFE ~ RFR + year + (1 | biol_site_id)</p>
<p>Below we split the macroinvertebrate data into spring and autumn
datasets, reflecting the potential for seasonal differences in
ecological responses to flow in chalk streams, ready to apply the
climwin approach to each.</p>
<div class="section level3">
<h3 id="prepare-the-data">Prepare the data<a class="anchor" aria-label="anchor" href="#prepare-the-data"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First filter the flow dataset to (i) ensure a match with an invertebrate sample site, (ii) remove</span></span>
<span><span class="co"># NAs and (iii) exclude RFRs &gt; 2.5 (i.e. exceptionally discharge-rich conditions that could signify</span></span>
<span><span class="co"># flow being augmented by effluent discharge)</span></span>
<span><span class="va">cs3_flow_data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cs3_flow_data</span>, <span class="va">flow_site_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">cs3_biol_data</span><span class="op">$</span><span class="va">biol_site_id</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">rfr</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.infinite</a></span><span class="op">(</span><span class="va">rfr</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rfr</span> <span class="op">&lt;=</span> <span class="fl">2.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter biology dataset to ensure match in flow dataset</span></span>
<span><span class="va">cs3_biol_data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cs3_biol_data</span>, <span class="va">biol_site_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">cs3_flow_data</span><span class="op">$</span><span class="va">flow_site_id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create spring biology dataset</span></span>
<span><span class="va">cs3_biol_data_spr</span> <span class="op">&lt;-</span> <span class="va">cs3_biol_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">month</span> <span class="op">&gt;</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="va">month</span> <span class="op">&lt;</span> <span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create autumn biology dataset</span></span>
<span><span class="va">cs3_biol_data_aut</span> <span class="op">&lt;-</span> <span class="va">cs3_biol_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">month</span> <span class="op">&gt;</span> <span class="fl">8</span> <span class="op">&amp;</span> <span class="va">month</span> <span class="op">&lt;</span> <span class="fl">12</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="apply-slidingwin-function">Apply slidingwin function<a class="anchor" aria-label="anchor" href="#apply-slidingwin-function"></a>
</h3>
<p>For climwin’s <em>slidingwin</em> function we have to specify a
number of arguments, the key ones being:</p>
<ul>
<li>xvar: the climate or- in a hydroecological context- flow variables
of interest. Here we use RFR as the ‘xvar’ argument.</li>
<li>cdate/bdate: the columns containing the date data across our two
datasets (which must be in the form dd/mm/yyyy).</li>
<li>baseline: the structure of the null hydroecological model (i.e. the
basic model to which the flow data for each tested time window will be
added), here a mixed-effects regression model of the form outlined
above. This argument takes the biology dataset as its data source.</li>
<li>cinterval: the temporal resolution of the analysis, here monthly to
reflect the resolution of the flow data.</li>
<li>range: the start and end of the time period over which the climate
(flow) window search will be undertaken, here 1-36 months prior to
invertebrate sample collection. Be aware that increasing the width of
the ‘range’ used in the analysis will increase the function’s processing
time.</li>
<li>type: the sliding window approach, either relative to a biological
sampling date (‘relative’) or not (‘absolute’). The latter option may be
useful for certain ecological receptors where the primary focus is on a
fixed season or growth period (e.g. macrophytes), but here we specify
‘relative’ as we are interested in periods preceding invertebrate
sampling dates.</li>
<li>stat: the aggregate statistic(s) by which the flow (RFR) data are to
be summarised, here simply the mean.</li>
<li>func: the function(s) used to fit the flow variable of interest
(RFR), here linear, quadratic and cubic.</li>
<li>spatial: corresponding factors that define the spatial groups which
the two datasets belong to (here biology and flow site IDs)</li>
</ul>
<p>For more information search ?slidingwin.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Spring</span></span>
<span></span>
<span><span class="co"># Linear model</span></span>
<span><span class="va">FlowWin_spr</span> <span class="op">&lt;-</span> <span class="fu">slidingwin</span><span class="op">(</span>xvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Flow <span class="op">=</span> <span class="va">cs3_flow_data</span><span class="op">$</span><span class="va">rfr</span><span class="op">)</span>, cdate <span class="op">=</span> <span class="va">cs3_flow_data</span><span class="op">$</span><span class="va">date</span>,</span>
<span>    bdate <span class="op">=</span> <span class="va">cs3_biol_data_spr</span><span class="op">$</span><span class="va">date</span>, baseline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">LIFE_FAMILY_INDEX</span> <span class="op">~</span> <span class="va">year</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span></span>
<span>        <span class="va">biol_site_id</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">cs3_biol_data_spr</span><span class="op">)</span>, cinterval <span class="op">=</span> <span class="st">"month"</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">36</span>,</span>
<span>        <span class="fl">0</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"relative"</span>, stat <span class="op">=</span> <span class="st">"mean"</span>, func <span class="op">=</span> <span class="st">"lin"</span>, cmissing <span class="op">=</span> <span class="st">"method2"</span>,</span>
<span>    spatial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">cs3_biol_data_spr</span><span class="op">$</span><span class="va">biol_site_id</span>, <span class="va">cs3_flow_data</span><span class="op">$</span><span class="va">flow_site_id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view data table summarising the results of all tested windows</span></span>
<span><span class="va">Output_sprL</span> <span class="op">&lt;-</span> <span class="va">FlowWin_spr</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Dataset</span></span>
<span></span>
<span><span class="co"># view summary of the best model</span></span>
<span><span class="va">Model_sprL</span> <span class="op">&lt;-</span> <span class="va">FlowWin_spr</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">BestModel</span></span>
<span></span>
<span><span class="co"># view dataframe containing the raw flow and biology data used to fit the best</span></span>
<span><span class="co"># model</span></span>
<span><span class="va">Data_sprL</span> <span class="op">&lt;-</span> <span class="va">FlowWin_spr</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">BestModelData</span></span>
<span></span>
<span><span class="co"># Quadratic model</span></span>
<span><span class="va">FlowWin_spr</span> <span class="op">&lt;-</span> <span class="fu">slidingwin</span><span class="op">(</span>xvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Flow <span class="op">=</span> <span class="va">cs3_flow_data</span><span class="op">$</span><span class="va">rfr</span><span class="op">)</span>, cdate <span class="op">=</span> <span class="va">cs3_flow_data</span><span class="op">$</span><span class="va">date</span>,</span>
<span>    bdate <span class="op">=</span> <span class="va">cs3_biol_data_spr</span><span class="op">$</span><span class="va">date</span>, baseline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">LIFE_FAMILY_INDEX</span> <span class="op">~</span> <span class="va">year</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span></span>
<span>        <span class="va">biol_site_id</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">cs3_biol_data_spr</span><span class="op">)</span>, cinterval <span class="op">=</span> <span class="st">"month"</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">36</span>,</span>
<span>        <span class="fl">0</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"relative"</span>, stat <span class="op">=</span> <span class="st">"mean"</span>, func <span class="op">=</span> <span class="st">"quad"</span>, cmissing <span class="op">=</span> <span class="st">"method2"</span>,</span>
<span>    spatial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">cs3_biol_data_spr</span><span class="op">$</span><span class="va">biol_site_id</span>, <span class="va">cs3_flow_data</span><span class="op">$</span><span class="va">flow_site_id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view data table summarising the results of all tested windows</span></span>
<span><span class="va">Output_sprQ</span> <span class="op">&lt;-</span> <span class="va">FlowWin_spr</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Dataset</span></span>
<span></span>
<span><span class="co"># best model fit</span></span>
<span><span class="va">Model_sprQ</span> <span class="op">&lt;-</span> <span class="va">FlowWin_spr</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">BestModel</span></span>
<span></span>
<span><span class="co"># view BestModelData: data frame containing the raw flow and biological data</span></span>
<span><span class="co"># used to fit BestModel</span></span>
<span><span class="va">Data_sprQ</span> <span class="op">&lt;-</span> <span class="va">FlowWin_spr</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">BestModelData</span></span>
<span></span>
<span><span class="co"># Cubic model</span></span>
<span><span class="va">FlowWin_spr</span> <span class="op">&lt;-</span> <span class="fu">slidingwin</span><span class="op">(</span>xvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Flow <span class="op">=</span> <span class="va">cs3_flow_data</span><span class="op">$</span><span class="va">rfr</span><span class="op">)</span>, cdate <span class="op">=</span> <span class="va">cs3_flow_data</span><span class="op">$</span><span class="va">date</span>,</span>
<span>    bdate <span class="op">=</span> <span class="va">cs3_biol_data_spr</span><span class="op">$</span><span class="va">date</span>, baseline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">LIFE_FAMILY_INDEX</span> <span class="op">~</span> <span class="va">year</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span></span>
<span>        <span class="va">biol_site_id</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">cs3_biol_data_spr</span><span class="op">)</span>, cinterval <span class="op">=</span> <span class="st">"month"</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">36</span>,</span>
<span>        <span class="fl">0</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"relative"</span>, stat <span class="op">=</span> <span class="st">"mean"</span>, func <span class="op">=</span> <span class="st">"cub"</span>, cmissing <span class="op">=</span> <span class="st">"method2"</span>,</span>
<span>    spatial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">cs3_biol_data_spr</span><span class="op">$</span><span class="va">biol_site_id</span>, <span class="va">cs3_flow_data</span><span class="op">$</span><span class="va">flow_site_id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view data table summarising the results of all tested windows</span></span>
<span><span class="va">Output_sprC</span> <span class="op">&lt;-</span> <span class="va">FlowWin_spr</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Dataset</span></span>
<span></span>
<span><span class="co"># best model fit</span></span>
<span><span class="va">Model_sprC</span> <span class="op">&lt;-</span> <span class="va">FlowWin_spr</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">BestModel</span></span>
<span></span>
<span><span class="co"># view BestModelData: data frame containing the raw flow and biological data</span></span>
<span><span class="co"># used to fit BestModel</span></span>
<span><span class="va">Data_sprC</span> <span class="op">&lt;-</span> <span class="va">FlowWin_spr</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">BestModelData</span></span>
<span></span>
<span></span>
<span><span class="co"># 2. Autumn</span></span>
<span></span>
<span><span class="co"># Linear model</span></span>
<span><span class="va">FlowWin_aut</span> <span class="op">&lt;-</span> <span class="fu">slidingwin</span><span class="op">(</span>xvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Flow <span class="op">=</span> <span class="va">cs3_flow_data</span><span class="op">$</span><span class="va">rfr</span><span class="op">)</span>, cdate <span class="op">=</span> <span class="va">cs3_flow_data</span><span class="op">$</span><span class="va">date</span>,</span>
<span>    bdate <span class="op">=</span> <span class="va">cs3_biol_data_aut</span><span class="op">$</span><span class="va">date</span>, baseline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">LIFE_FAMILY_INDEX</span> <span class="op">~</span> <span class="va">year</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span></span>
<span>        <span class="va">biol_site_id</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">cs3_biol_data_aut</span><span class="op">)</span>, cinterval <span class="op">=</span> <span class="st">"month"</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">36</span>,</span>
<span>        <span class="fl">0</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"relative"</span>, stat <span class="op">=</span> <span class="st">"mean"</span>, func <span class="op">=</span> <span class="st">"lin"</span>, cmissing <span class="op">=</span> <span class="st">"method2"</span>,</span>
<span>    spatial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">cs3_biol_data_aut</span><span class="op">$</span><span class="va">biol_site_id</span>, <span class="va">cs3_flow_data</span><span class="op">$</span><span class="va">flow_site_id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view data table summarising the results of all tested windows</span></span>
<span><span class="va">Output_autL</span> <span class="op">&lt;-</span> <span class="va">FlowWin_aut</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Dataset</span></span>
<span></span>
<span><span class="co"># best model fit</span></span>
<span><span class="va">Model_autL</span> <span class="op">&lt;-</span> <span class="va">FlowWin_aut</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">BestModel</span></span>
<span></span>
<span><span class="co"># view BestModelData: data frame containing the raw flow and biological data</span></span>
<span><span class="co"># used to fit BestModel</span></span>
<span><span class="va">Data_autL</span> <span class="op">&lt;-</span> <span class="va">FlowWin_aut</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">BestModelData</span></span>
<span></span>
<span><span class="co"># Quadratic model</span></span>
<span><span class="va">FlowWin_aut</span> <span class="op">&lt;-</span> <span class="fu">slidingwin</span><span class="op">(</span>xvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Flow <span class="op">=</span> <span class="va">cs3_flow_data</span><span class="op">$</span><span class="va">rfr</span><span class="op">)</span>, cdate <span class="op">=</span> <span class="va">cs3_flow_data</span><span class="op">$</span><span class="va">date</span>,</span>
<span>    bdate <span class="op">=</span> <span class="va">cs3_biol_data_aut</span><span class="op">$</span><span class="va">date</span>, baseline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">LIFE_FAMILY_INDEX</span> <span class="op">~</span> <span class="va">year</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span></span>
<span>        <span class="va">biol_site_id</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">cs3_biol_data_aut</span><span class="op">)</span>, cinterval <span class="op">=</span> <span class="st">"month"</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">36</span>,</span>
<span>        <span class="fl">0</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"relative"</span>, stat <span class="op">=</span> <span class="st">"mean"</span>, func <span class="op">=</span> <span class="st">"quad"</span>, cmissing <span class="op">=</span> <span class="st">"method2"</span>,</span>
<span>    spatial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">cs3_biol_data_aut</span><span class="op">$</span><span class="va">biol_site_id</span>, <span class="va">cs3_flow_data</span><span class="op">$</span><span class="va">flow_site_id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view data table summarising the results of all tested windows</span></span>
<span><span class="va">Output_autQ</span> <span class="op">&lt;-</span> <span class="va">FlowWin_aut</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Dataset</span></span>
<span></span>
<span><span class="co"># best model fit</span></span>
<span><span class="va">Model_autQ</span> <span class="op">&lt;-</span> <span class="va">FlowWin_aut</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">BestModel</span></span>
<span></span>
<span><span class="co"># view BestModelData: data frame containing the raw flow and biological data</span></span>
<span><span class="co"># used to fit BestModel</span></span>
<span><span class="va">Data_autQ</span> <span class="op">&lt;-</span> <span class="va">FlowWin_aut</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">BestModelData</span></span>
<span></span>
<span></span>
<span><span class="co"># Cubic model</span></span>
<span><span class="va">FlowWin_aut</span> <span class="op">&lt;-</span> <span class="fu">slidingwin</span><span class="op">(</span>xvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Flow <span class="op">=</span> <span class="va">cs3_flow_data</span><span class="op">$</span><span class="va">rfr</span><span class="op">)</span>, cdate <span class="op">=</span> <span class="va">cs3_flow_data</span><span class="op">$</span><span class="va">date</span>,</span>
<span>    bdate <span class="op">=</span> <span class="va">cs3_biol_data_aut</span><span class="op">$</span><span class="va">date</span>, baseline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">LIFE_FAMILY_INDEX</span> <span class="op">~</span> <span class="va">year</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span></span>
<span>        <span class="va">biol_site_id</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">cs3_biol_data_aut</span><span class="op">)</span>, cinterval <span class="op">=</span> <span class="st">"month"</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">36</span>,</span>
<span>        <span class="fl">0</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"relative"</span>, stat <span class="op">=</span> <span class="st">"mean"</span>, func <span class="op">=</span> <span class="st">"cub"</span>, cmissing <span class="op">=</span> <span class="st">"method2"</span>,</span>
<span>    spatial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">cs3_biol_data_aut</span><span class="op">$</span><span class="va">biol_site_id</span>, <span class="va">cs3_flow_data</span><span class="op">$</span><span class="va">flow_site_id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view data table summarising the results of all tested windows</span></span>
<span><span class="va">Output_autC</span> <span class="op">&lt;-</span> <span class="va">FlowWin_aut</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Dataset</span></span>
<span></span>
<span><span class="co"># best model fit</span></span>
<span><span class="va">Model_autC</span> <span class="op">&lt;-</span> <span class="va">FlowWin_aut</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">BestModel</span></span>
<span></span>
<span><span class="co"># view BestModelData: data frame containing the raw flow and biological data</span></span>
<span><span class="co"># used to fit BestModel</span></span>
<span><span class="va">Data_autC</span> <span class="op">&lt;-</span> <span class="va">FlowWin_aut</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">BestModelData</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="compare-models">Compare Models<a class="anchor" aria-label="anchor" href="#compare-models"></a>
</h3>
<p>We can now compare the best linear, quadratic and cubic models for
each dataset (spring and autumn) using the corrected Akaike information
criterion (AICc), which provides a measure of the relative quality of
the different models based on estimates of their prediction error (the
lower the AICc, the better the model).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># select the best 6 models (spring &amp; autumn: linear, quadratic &amp; cubic)</span></span>
<span><span class="va">sprL</span> <span class="op">&lt;-</span> <span class="va">Output_sprL</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">deltaAICc</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">deltaAICc</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Season <span class="op">=</span> <span class="st">"Spring"</span><span class="op">)</span></span>
<span><span class="va">sprQ</span> <span class="op">&lt;-</span> <span class="va">Output_sprQ</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">deltaAICc</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">deltaAICc</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Season <span class="op">=</span> <span class="st">"Spring"</span><span class="op">)</span></span>
<span><span class="va">sprC</span> <span class="op">&lt;-</span> <span class="va">Output_sprC</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">deltaAICc</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">deltaAICc</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Season <span class="op">=</span> <span class="st">"Spring"</span><span class="op">)</span></span>
<span><span class="va">autL</span> <span class="op">&lt;-</span> <span class="va">Output_autL</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">deltaAICc</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">deltaAICc</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Season <span class="op">=</span> <span class="st">"Autumn"</span><span class="op">)</span></span>
<span><span class="va">autQ</span> <span class="op">&lt;-</span> <span class="va">Output_autQ</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">deltaAICc</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">deltaAICc</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Season <span class="op">=</span> <span class="st">"Autumn"</span><span class="op">)</span></span>
<span><span class="va">autC</span> <span class="op">&lt;-</span> <span class="va">Output_autC</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">deltaAICc</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">deltaAICc</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Season <span class="op">=</span> <span class="st">"Autumn"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine the 6 model summaries into one table and view</span></span>
<span><span class="va">BestFit</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">sprL</span>, <span class="va">sprQ</span>, <span class="va">sprC</span>, <span class="va">autL</span>, <span class="va">autQ</span>, <span class="va">autC</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Season</span>, <span class="va">Function</span>, <span class="va">deltaAICc</span><span class="op">:</span><span class="va">WindowClose</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">BestFit</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
Season
</th>
<th style="text-align:left;">
Function
</th>
<th style="text-align:right;">
deltaAICc
</th>
<th style="text-align:right;">
WindowOpen
</th>
<th style="text-align:right;">
WindowClose
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Spring
</td>
<td style="text-align:left;">
lin
</td>
<td style="text-align:right;">
-26.66460
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
Spring
</td>
<td style="text-align:left;">
quad
</td>
<td style="text-align:right;">
-37.72406
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
Spring
</td>
<td style="text-align:left;">
cub
</td>
<td style="text-align:right;">
-46.36475
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Autumn
</td>
<td style="text-align:left;">
lin
</td>
<td style="text-align:right;">
-18.89924
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
Autumn
</td>
<td style="text-align:left;">
quad
</td>
<td style="text-align:right;">
-17.81980
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
Autumn
</td>
<td style="text-align:left;">
cub
</td>
<td style="text-align:right;">
-16.92436
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
6
</td>
</tr>
</tbody>
</table>
<p>We can see from the table that the best-fit cubic model performs
better (lowest deltaAICc) than the best-fit linear and quadratic models
for spring and that the best-fit linear model performs best for autumn.
We can also see that the time window over which the LIFE index is best
predicted by mean antecedent RFR differs between spring and autumn (1-30
months for spring and 5-7 for autumn).</p>
<p>Note that ‘deltaAICc’ is a relative measure of model performance,
defined as the difference between the model in question and the null
model (i.e. one with no flow data).</p>
</div>
</div>
<div class="section level2">
<h2 id="plotting-output">Plotting output<a class="anchor" aria-label="anchor" href="#plotting-output"></a>
</h2>
<div class="section level3">
<h3 id="flow-ecology-relationships">Flow-ecology relationships<a class="anchor" aria-label="anchor" href="#flow-ecology-relationships"></a>
</h3>
<p>We can now visualise the response of LIFE to RFR as predicted by the
best models for spring (cubic) and autumn (linear):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Spring</span></span>
<span></span>
<span><span class="co"># rename default climwin variables</span></span>
<span><span class="va">Data_sprC</span> <span class="op">&lt;-</span> <span class="va">Data_sprC</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>RFR <span class="op">=</span> <span class="va">climate</span>, LIFE_F <span class="op">=</span> <span class="va">yvar</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run spring-cubic model</span></span>
<span><span class="va">lmer_sprC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">LIFE_F</span> <span class="op">~</span> <span class="va">year</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">biol_site_id</span><span class="op">)</span> <span class="op">+</span> <span class="va">RFR</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">RFR</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">RFR</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">Data_sprC</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot spring-cubic model predicted values</span></span>
<span><span class="va">plot_lmer_sprC</span> <span class="op">&lt;-</span> <span class="fu">sjPlot</span><span class="fu">::</span><span class="fu"><a href="https://strengejacke.github.io/sjPlot/reference/plot_model.html" class="external-link">plot_model</a></span><span class="op">(</span><span class="va">lmer_sprC</span>, type <span class="op">=</span> <span class="st">"pred"</span>, terms <span class="op">=</span> <span class="st">"RFR [all]"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Autumn</span></span>
<span></span>
<span><span class="co"># rename default climwin variables</span></span>
<span><span class="va">Data_autL</span> <span class="op">&lt;-</span> <span class="va">Data_autL</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>RFR <span class="op">=</span> <span class="va">climate</span>, LIFE_F <span class="op">=</span> <span class="va">yvar</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run spring-linear model</span></span>
<span><span class="va">lmer_autL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">LIFE_F</span> <span class="op">~</span> <span class="va">year</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">biol_site_id</span><span class="op">)</span> <span class="op">+</span> <span class="va">RFR</span>, data <span class="op">=</span> <span class="va">Data_autL</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot spring-linear model predicted values</span></span>
<span><span class="va">plot_lmer_autL</span> <span class="op">&lt;-</span> <span class="fu">sjPlot</span><span class="fu">::</span><span class="fu"><a href="https://strengejacke.github.io/sjPlot/reference/plot_model.html" class="external-link">plot_model</a></span><span class="op">(</span><span class="va">lmer_autL</span>, type <span class="op">=</span> <span class="st">"pred"</span>, terms <span class="op">=</span> <span class="st">"RFR [all]"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_lmer_sprC</span></span></code></pre></div>
<p><img src="CaseStudy4_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_lmer_autL</span></span></code></pre></div>
<p><img src="CaseStudy4_files/figure-html/unnamed-chunk-5-2.png" width="700"></p>
<p>We can see that both models predict intuitive but different
flow-ecology relationships, with a peak in LIFE scores when historical
flows are equal to naturalised (RFR = 1) in spring and a linear increase
of LIFE with RFR in autumn.</p>
<p>Note that care should typically be taken when interpreting
higher-degree polynomial (e.g. cubic) models due to their propensity for
‘overfitting’, whereby residual variation in the data is captured at the
expense of describing the underlying relationship. For instance, if we
were interested in further exploring the impact of flow augmentation
(RFR &gt; 1) on LIFE, we may want to validate the relationship depicted
by the cubic model with a more robust approach, such as a generalised
additive model (GAM).</p>
</div>
<div class="section level3">
<h3 id="aic-heatmaps">AIC heatmaps<a class="anchor" aria-label="anchor" href="#aic-heatmaps"></a>
</h3>
<p>We can visualise the distribution of deltaAICc values across all
tested flow windows with heatmaps, created using the <em>plotdelta</em>
function in the climwin package. Blue regions represent flow windows
with limited strength (AICc values similar to the null model) while the
best predicting windows are denoted by red areas.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot AICc heatmap for spring-cubic model</span></span>
<span><span class="fu">plotdelta</span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">Output_sprC</span><span class="op">)</span></span></code></pre></div>
<p><img src="CaseStudy4_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot AICc heatmap for autumn-linear model</span></span>
<span><span class="fu">plotdelta</span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">Output_autL</span><span class="op">)</span></span></code></pre></div>
<p><img src="CaseStudy4_files/figure-html/unnamed-chunk-6-2.png" width="700"></p>
<p>For spring, we see a region of strong windows down the left side of
the heatmap that is relatively diffuse but with an epicentre
corresponding to the optimal flow window of 1-30 months that we
identified above. The horizontal colour gradient appears more pronounced
than the vertical gradient, implying that the close of the window is a
more critical determinant of model performance than the opening. For
autumn, the peak in model performance is much more concentrated,
highlighting the importance of selecting appropriate values for both
window opening and closure.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by APEM-Ltd.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
